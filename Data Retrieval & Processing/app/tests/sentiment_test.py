from SentimentAnalyser import SentimentAnalyser
import pytest

__analyser = SentimentAnalyser()
tweet = {'created_at': 'Mon Mar 19 23:32:31 +0000 2018', 'id': 975877710902853632, 'id_str': '975877710902853632', 'text': 'Really looking forward to receiving my copy of this book. By young people, for young people! https://t.co/NwNtNfbaRj', 'display_text_range': [0, 92], 'source': '<a href="http://twitter.com/download/iphone" rel="nofollow">Twitter for iPhone</a>', 'truncated': False, 'in_reply_to_status_id': None, 'in_reply_to_status_id_str': None, 'in_reply_to_user_id': None, 'in_reply_to_user_id_str': None, 'in_reply_to_screen_name': None, 'user': {'id': 4869692067, 'id_str': '4869692067', 'name': 'Sharon Hayward', 'screen_name': 'EdSAttainGCC', 'location': 'Glasgow, Scotland', 'url': None, 'description': 'Attainment Advisor with The Scottish Attainment Challenge, working in partnership with colleagues in Glasgow.', 'translator_type': 'none', 'protected': False, 'verified': False, 'followers_count': 1564, 'friends_count': 203, 'listed_count': 21, 'favourites_count': 3010, 'statuses_count': 2340, 'created_at': 'Mon Feb 01 16:49:30 +0000 2016', 'utc_offset': None, 'time_zone': None, 'geo_enabled': True, 'lang': 'en-GB', 'contributors_enabled': False, 'is_translator': False, 'profile_background_color': 'F5F8FA', 'profile_background_image_url': '', 'profile_background_image_url_https': '', 'profile_background_tile': False, 'profile_link_color': '1DA1F2', 'profile_sidebar_border_color': 'C0DEED', 'profile_sidebar_fill_color': 'DDEEF6', 'profile_text_color': '333333', 'profile_use_background_image': True, 'profile_image_url': 'http://pbs.twimg.com/profile_images/694201701033730051/AB5gltD8_normal.jpg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/694201701033730051/AB5gltD8_normal.jpg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/4869692067/1454345750', 'default_profile': True, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None}, 'geo': None, 'coordinates': None, 'place': {'id': '791e00bcadc4615f', 'url': 'https://api.twitter.com/1.1/geo/id/791e00bcadc4615f.json', 'place_type': 'city', 'name': 'Glasgow', 'full_name': 'Glasgow, Scotland', 'country_code': 'GB', 'country': 'United Kingdom', 'bounding_box': {'type': 'Polygon', 'coordinates': [[[-4.393285, 55.796184], [-4.393285, 55.920421], [-4.090218, 55.920421], [-4.090218, 55.796184]]]}, 'attributes': {}}, 'contributors': None, 'quoted_status_id': 974203081121558528, 'quoted_status_id_str': '974203081121558528', 'quoted_status': {'created_at': 'Thu Mar 15 08:38:09 +0000 2018', 'id': 974203081121558528, 'id_str': '974203081121558528', 'text': 'Just a reminder that this year’s @YE_Scotland team @Brave_Bairns have written a children’s book about dementia. It’… https://t.co/bVXKTE4mTl', 'source': '<a href="http://twitter.com/download/iphone" rel="nofollow">Twitter for iPhone</a>', 'truncated': True, 'in_reply_to_status_id': None, 'in_reply_to_status_id_str': None, 'in_reply_to_user_id': None, 'in_reply_to_user_id_str': None, 'in_reply_to_screen_name': None, 'user': {'id': 1128381066, 'id_str': '1128381066', 'name': 'LochendHighSchool', 'screen_name': 'LochendHigh', 'location': 'Easterhouse, Glasgow', 'url': 'http://www.lochendcommunityhigh.glasgow.sch.uk', 'description': 'Lochend Community High School is a non-denominational comprehensive secondary school in Easterhouse, Glasgow.', 'translator_type': 'none', 'protected': False, 'verified': False, 'followers_count': 1401, 'friends_count': 467, 'listed_count': 28, 'favourites_count': 884, 'statuses_count': 1124, 'created_at': 'Mon Jan 28 15:29:29 +0000 2013', 'utc_offset': -36000, 'time_zone': 'Hawaii', 'geo_enabled': True, 'lang': 'en', 'contributors_enabled': False, 'is_translator': False, 'profile_background_color': 'C0DEED', 'profile_background_image_url': 'http://abs.twimg.com/images/themes/theme1/bg.png', 'profile_background_image_url_https': 'https://abs.twimg.com/images/themes/theme1/bg.png', 'profile_background_tile': False, 'profile_link_color': '0018B3', 'profile_sidebar_border_color': 'C0DEED', 'profile_sidebar_fill_color': 'DDEEF6', 'profile_text_color': '333333', 'profile_use_background_image': True, 'profile_image_url': 'http://pbs.twimg.com/profile_images/546229168175075328/sVJpj1aA_normal.jpeg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/546229168175075328/sVJpj1aA_normal.jpeg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/1128381066/1513708788', 'default_profile': False, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None}, 'geo': None, 'coordinates': None, 'place': None, 'contributors': None, 'is_quote_status': False, 'extended_tweet': {'full_text': 'Just a reminder that this year’s @YE_Scotland team @Brave_Bairns have written a children’s book about dementia. It’s aimed at helping young people deal with dementia and can be ordered on their website https://t.co/sKpNrIlc7R #bravebairns #papalovesyou #dementiaawareness', 'display_text_range': [0, 271], 'entities': {'hashtags': [{'text': 'bravebairns', 'indices': [226, 238]}, {'text': 'papalovesyou', 'indices': [239, 252]}, {'text': 'dementiaawareness', 'indices': [253, 271]}], 'urls': [{'url': 'https://t.co/sKpNrIlc7R', 'expanded_url': 'http://www.bravebairns.co.uk', 'display_url': 'bravebairns.co.uk', 'indices': [202, 225]}], 'user_mentions': [{'screen_name': 'YE_Scotland', 'name': 'YoungEnterpriseScot', 'id': 191523155, 'id_str': '191523155', 'indices': [33, 45]}, {'screen_name': 'Brave_Bairns', 'name': 'Brave Bairns', 'id': 931450582002470913, 'id_str': '931450582002470913', 'indices': [51, 64]}], 'symbols': []}}, 'quote_count': 0, 'reply_count': 0, 'retweet_count': 2, 'favorite_count': 5, 'entities': {'hashtags': [], 'urls': [{'url': 'https://t.co/bVXKTE4mTl', 'expanded_url': 'https://twitter.com/i/web/status/974203081121558528', 'display_url': 'twitter.com/i/web/status/9…', 'indices': [117, 140]}], 'user_mentions': [{'screen_name': 'YE_Scotland', 'name': 'YoungEnterpriseScot', 'id': 191523155, 'id_str': '191523155', 'indices': [33, 45]}, {'screen_name': 'Brave_Bairns', 'name': 'Brave Bairns', 'id': 931450582002470913, 'id_str': '931450582002470913', 'indices': [51, 64]}], 'symbols': []}, 'favorited': False, 'retweeted': False, 'possibly_sensitive': False, 'filter_level': 'low', 'lang': 'en'}, 'is_quote_status': True, 'quote_count': 0, 'reply_count': 0, 'retweet_count': 0, 'favorite_count': 0, 'entities': {'hashtags': [], 'urls': [{'url': 'https://t.co/NwNtNfbaRj', 'expanded_url': 'https://twitter.com/lochendhigh/status/974203081121558528', 'display_url': 'twitter.com/lochendhigh/st…', 'indices': [93, 116]}], 'user_mentions': [], 'symbols': []}, 'favorited': False, 'retweeted': False, 'possibly_sensitive': False, 'filter_level': 'low', 'lang': 'en', 'timestamp_ms': '1521502351867'}


def test_sentiment_scored():
    if 'extended_tweet' in tweet:
        full_text = tweet.get('extended_tweet').get('full_text')
    else:
        full_text = tweet.get('text')

    # Tweet sentiment scores
    sentiment_text = ' '.join(
        list(filter(lambda word: not word.startswith(('@', 'http://', 'https://', '&')), full_text.split(' '))))
    assert isinstance(sentiment_text, str)
    scores = __analyser.calculate_sentiment_scores(sentiment_text)
    assert isinstance(scores, dict)
    assert isinstance(scores.get('neu'), float)
    assert isinstance(scores.get('neg'), float)
    assert isinstance(scores.get('pos'), float)
    assert isinstance(scores.get('compound'), float)
    sentiment_words = [word.lower() for word in __analyser.get_sentiment_words(sentiment_text)]
    assert isinstance(sentiment_words, list) and isinstance(sentiment_words[0], str)
    sentiment_word_scores = __analyser.get_sentiment_word_scores(sentiment_text)
    assert isinstance(sentiment_word_scores, list) and isinstance(sentiment_word_scores[0], (float, int))

